

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Locales &mdash; Chapel Documentation 1.17</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
  

  
    <link rel="top" title="Chapel Documentation 1.17" href="../index.html"/>
        <link rel="up" title="Primers" href="index.html"/>
        <link rel="next" title="Ranges" href="ranges.html"/>
        <link rel="prev" title="Atomics" href="atomics.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

<a href="../index.html" class="icon icon-home"> Chapel Documentation</a>

<?php
// Variables given by sphinx
$chplTitle = "1.17";
$pagename = "primers/locales";
include "..//versionButton.php";
?>


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Compiling and Running Chapel</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/QUICKSTART.html">Quickstart Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usingchapel/index.html">Using Chapel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms/index.html">Platform-Specific Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../technotes/index.html">Technical Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Tools</a></li>
</ul>
<p class="caption"><span class="caption-text">Writing Chapel Programs</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../language/reference.html">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Hello World Variants</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Primers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#language-basics">Language Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#iterators">Iterators</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#task-parallelism">Task Parallelism</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#locality">Locality</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="">Locales</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#data-parallelism">Data Parallelism</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#library-utilities">Library Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#numerical-libraries">Numerical Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#tools">Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#language-overview">Language Overview</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../language/spec.html">Language Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../builtins/index.html">Built-in Types and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/standard.html">Standard Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/packages.html">Package Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/layoutdist.html">Standard Layouts and Distributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../users-guide/index.html">Chapel Users Guide (WIP)</a></li>
</ul>
<p class="caption"><span class="caption-text">Language History</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../language/evolution.html">Chapel Evolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language/archivedSpecs.html">Archived Language Specifications</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Chapel Documentation</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Primers</a> &raquo;</li>
      
    <li>Locales</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/primers/locales.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="locales">
<span id="primers-locales"></span><h1>Locales<a class="headerlink" href="#locales" title="Permalink to this headline">Â¶</a></h1>
<p><a class="reference external" href="https://github.com/chapel-lang/chapel/blob/master/test/release/examples/primers/locales.chpl">View locales.chpl on GitHub</a></p>
<p>This example showcases Chapel's locale types.  To run this example
using multiple locales set up your environment as described in
<a class="reference internal" href="../usingchapel/multilocale.html#readme-multilocale"><span>multilocale documentation</span></a> and execute it
using the <code class="docutils literal"><span class="pre">-nl</span> <span class="pre">#</span></code> flag to specify  the number of locales.
For example, to run on 2 locales, run: <code class="docutils literal"><span class="pre">./locales</span> <span class="pre">-nl</span> <span class="pre">2</span></code></p>
<p>In Chapel, the <code class="docutils literal"><span class="pre">locale</span></code> type refers to a unit of the machine
resources on which your program is running.  Locales have the
capability to store variables (i.e., they have memory) and to run
Chapel tasks (i.e., they have processors).  The specific definition
of <code class="docutils literal"><span class="pre">locale</span></code> for a given target architecture is determined by the
Chapel compiler and architecture.  In practice for a standard
distributed memory architecture a single multicore/SMP node is
typically considered a locale.  Shared memory architectures are
typically considered a single locale.  See
<a class="reference internal" href="../platforms/index.html#platforms-index"><span>platform-specific documentation</span></a>
for notes that might relate to locales on a given architecture.</p>
<p>As mentioned above, the number of locales on which a Chapel program
should be run is specified on the executable command line using the
<code class="docutils literal"><span class="pre">-nl</span> <span class="pre">&lt;numLocales&gt;</span></code> or <code class="docutils literal"><span class="pre">--numLocales=&lt;numLocales&gt;</span></code> flag.  This will
cause the Chapel's launcher to execute the program on <code class="docutils literal"><span class="pre">&lt;numLocales&gt;</span></code>
locales.</p>
<p>Within a Chapel program, the number of locales can be referred
to symbolically using the built-in <code class="docutils literal"><span class="pre">numLocales</span></code> variable.
For example:</p>
<div class="highlight-chapel"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;This program is running on &quot;</span><span class="p">,</span> <span class="nx">numLocales</span><span class="p">,</span> <span class="s">&quot; locales&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Chapel programs always start executing from locale #0.  The
locale on which the current piece of code is executing can
always be queried in a Chapel program using the builtin <code class="docutils literal"><span class="pre">here</span></code>
variable, which has <code class="docutils literal"><span class="pre">locale</span></code> type.  All <code class="docutils literal"><span class="pre">locale</span></code> values implement
the <code class="docutils literal"><span class="pre">id</span></code> query that returns a unique value from 0 to <code class="docutils literal"><span class="pre">numLocales-1</span></code>.
Here we verify that this program began running on locale 0:</p>
<div class="highlight-chapel"><div class="highlight"><pre><span></span><span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;It began running on locale #&quot;</span><span class="p">,</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Chapel also provides a built-in <code class="docutils literal"><span class="pre">Locales</span></code> array that contains the
set of locale values corresponding to the machine resources on
which the program is running.  This <code class="docutils literal"><span class="pre">Locales</span></code> array is the main
way for bootstrapping distributed memory computations, whether
explicitly (using on-clauses) or implicitly (using
<a class="reference internal" href="distributions.html#primers-distributions"><span>distributions</span></a>).</p>
<p>As an example, the following for loop iterates over the <code class="docutils literal"><span class="pre">Locales</span></code>
array and then uses an on-clause to specify that each iteration
should execute on that specific locale.  Within the body of the
loop we use <code class="docutils literal"><span class="pre">here</span></code> and the <code class="docutils literal"><span class="pre">.id</span></code> query to indicate what locale
each iteration of the loop body is executing on.</p>
<div class="highlight-chapel"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="nx">loc</span> <span class="kd">in</span> <span class="nx">Locales</span> <span class="k">do</span>
  <span class="k">on</span> <span class="nx">loc</span> <span class="k">do</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;hello locale &quot;</span><span class="p">,</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Note that in Chapel, locality and parallelism are orthogonal
concepts.  That is, nothing about the use of the on-clause above
introduced parallelism into the program, it only moved the current
task (conceptually) from locale #0 to another locale.  Task and
data parallel concepts can be intermixed with on-clauses to get
parallelism across distributed memory machine resources. In this example
we focus on the locality issues and do not illustrate parallelism.</p>
<p>Locale values can be assigned and stored like any other value.
For example, the user can create their own view of the <code class="docutils literal"><span class="pre">Locales</span></code>
array.  The following statement creates a <code class="docutils literal"><span class="pre">1..10</span></code> array of locales
in which we'll store our <code class="docutils literal"><span class="pre">numLocales</span></code> unique locale values
redundantly if <code class="docutils literal"><span class="pre">numLocales</span></code> is less than 10:</p>
<div class="highlight-chapel"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">MyLocaleArray</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">]</span> <span class="nx">locale</span><span class="p">;</span>

<span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span> <span class="k">do</span>
  <span class="nx">MyLocaleArray</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Locales</span><span class="p">[(</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nx">numLocales</span><span class="p">];</span>

<span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span> <span class="k">do</span>
  <span class="k">on</span> <span class="nx">MyLocaleArray</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">do</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;MyLocaleArray[&quot;</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="s">&quot;] is really locale &quot;</span><span class="p">,</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Similarly, the user could arrange the locales into a
multidimensional virtual locale grid by storing the locale
values into a higher-dimensional array of locales. The array
<a class="reference internal" href="../builtins/internal/ChapelArray.html#ChapelArray.reshape" title="ChapelArray.reshape"><code class="xref chpl chpl-proc docutils literal"><span class="pre">reshape()</span></code></a> function can be particularly useful
for this purpose.</p>
<p>In addition to the <code class="docutils literal"><span class="pre">.id</span></code> query mentioned above, locales support a
number of other queries about their properties.  For example:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">locale.name</span></code>       : returns a string indicating the locale's name</li>
<li><code class="docutils literal"><span class="pre">locale.numPUs()</span></code>   : returns the number of processor cores on the locale</li>
<li><code class="docutils literal"><span class="pre">locale.physicalMemory()</span></code> : returns the amount of memory on the locale</li>
<li><code class="docutils literal"><span class="pre">locale.maxTaskPar</span></code> : returns the likely maximum parallelism available
on the locale</li>
</ul>
<div class="highlight-chapel"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Memory</span><span class="p">;</span>  <span class="c1">// for physicalMemory()</span>
<span class="kd">config</span> <span class="kd">const</span> <span class="nx">printLocaleInfo</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>  <span class="c1">// permit testing to turn this off</span>

<span class="k">if</span> <span class="nx">printLocaleInfo</span> <span class="k">then</span>
  <span class="k">for</span> <span class="nx">loc</span> <span class="kd">in</span> <span class="nx">Locales</span> <span class="k">do</span>
    <span class="k">on</span> <span class="nx">loc</span> <span class="p">{</span>
      <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;locale #&quot;</span><span class="p">,</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="s">&quot;...&quot;</span><span class="p">);</span>
      <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;  ...is named: &quot;</span><span class="p">,</span> <span class="nx">here</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
      <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;  ...has &quot;</span><span class="p">,</span> <span class="nx">here</span><span class="p">.</span><span class="nx">numPUs</span><span class="p">(),</span> <span class="s">&quot; processor cores&quot;</span><span class="p">);</span>
      <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;  ...has &quot;</span><span class="p">,</span> <span class="nx">here</span><span class="p">.</span><span class="nx">physicalMemory</span><span class="p">(</span><span class="nx">unit</span><span class="o">=</span><span class="nx">MemUnits</span><span class="p">.</span><span class="nx">GB</span><span class="p">,</span> <span class="nx">retType</span><span class="o">=</span><span class="kt">real</span><span class="p">),</span>
              <span class="s">&quot; GB of memory&quot;</span><span class="p">);</span>
      <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;  ...has &quot;</span><span class="p">,</span> <span class="nx">here</span><span class="p">.</span><span class="nx">maxTaskPar</span><span class="p">,</span> <span class="s">&quot; maximum parallelism&quot;</span><span class="p">);</span>
    <span class="p">}</span>

<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Chapel variables are stored using the memory of the locale
executing the task that encounters the variable declaration.
Thus, in the following code, <code class="docutils literal"><span class="pre">x</span></code> is declared on locale 0 and
<code class="docutils literal"><span class="pre">y</span></code> is declared on locale 1 when there is more than one locale
(on locale 0 otherwise).</p>
<div class="highlight-chapel"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="kd">var</span> <span class="nx">x</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">on</span> <span class="nx">Locales</span><span class="p">[</span><span class="mi">1</span> <span class="o">%</span> <span class="nx">numLocales</span><span class="p">]</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">y</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;From locale &quot;</span><span class="p">,</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="s">&quot;, x is: &quot;</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="s">&quot; and y is: &quot;</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
    <span class="k">on</span> <span class="nx">Locales</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">{</span>
      <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;From locale 0, x is: &quot;</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="s">&quot; and y is: &quot;</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">writeln</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note in the code above that a task can refer to any
lexically-visible variable in Chapel regardless of the locales on
which the variable is stored and the task is executing.  This is
what is known as a <em>global namespace</em> (or <em>global address space</em>)
quality in a language.  The fact that locality within a Chapel
program can be semantically reasoned about by the programmer (i.e.,
&quot;<code class="docutils literal"><span class="pre">x</span></code> is on Locale 0, <code class="docutils literal"><span class="pre">y</span></code> is on Locale 1&quot;) makes it a PGAS or
<em>Partitioned Global Address Space</em> language (though we prefer the
less broadly-used term <em>Partitioned Global Namespace</em>).</p>
<p>Not only can a programmer reason about a variable or task's
location abstractly, they can also query these values directly
in the language.  In particular, all Chapel variables support a
<code class="docutils literal"><span class="pre">.locale</span></code> query which returns the locale value that is storing that
variable.  Modifying the above example slightly:</p>
<div class="highlight-chapel"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="kd">var</span> <span class="nx">x</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">on</span> <span class="nx">Locales</span><span class="p">[</span><span class="mi">1</span> <span class="o">%</span> <span class="nx">numLocales</span><span class="p">]</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">y</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;x is stored on locale &quot;</span><span class="p">,</span> <span class="nx">x</span><span class="p">.</span><span class="nx">locale</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="s">&quot;, while y lives on &quot;</span><span class="p">,</span>
            <span class="nx">y</span><span class="p">.</span><span class="nx">locale</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="nx">writeln</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Moreover, Chapel's on-clauses can be controlled by any expression
with storage associated with it.  <code class="docutils literal"><span class="pre">on</span> <span class="pre">x</span></code> effectively says &quot;execute
this on whichever locale owns <code class="docutils literal"><span class="pre">x</span></code>&quot; or equivalently <code class="docutils literal"><span class="pre">on</span> <span class="pre">x.locale</span></code>.
Here's a variation of the example above using this idiom:</p>
<div class="highlight-chapel"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="kd">var</span> <span class="nx">x</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

  <span class="k">on</span> <span class="nx">Locales</span><span class="p">[</span><span class="mi">1</span> <span class="o">%</span> <span class="nx">numLocales</span><span class="p">]</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">y</span><span class="p">:</span> <span class="kt">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="k">on</span> <span class="nx">x</span> <span class="k">do</span>
      <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;Using a data-driven on-clause, I&#39;m now executing on locale &quot;</span><span class="p">,</span>
              <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">writeln</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Next, let's create a simple distributed data structure using the
principles above.  In particular, we'll create a linked list that
spans the locales with a list node per locale.</p>
<p>First, we'll define a standard <code class="docutils literal"><span class="pre">Node</span></code> class for linked lists.  Note
that even though the <code class="docutils literal"><span class="pre">next</span></code> fields will span locales, they don't need
to be declared specially in any way, again thanks to the [P]GAS
nature of the language.</p>
<div class="highlight-chapel"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Node</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">data</span><span class="p">:</span> <span class="kt">real</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">next</span><span class="p">:</span> <span class="nx">Node</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Next, we'll iterate through the locales, allocating a node on each.
It's worth reviewing that a class variable (like the <code class="docutils literal"><span class="pre">next</span></code> field
above) is just a reference in Chapel and the object it points to
is a separate thing allocated by a call to <code class="docutils literal"><span class="pre">new</span></code>.  So in general,
the reference and object can live on different locales (as they
will in our example).</p>
<p>So, in the following loop, <code class="docutils literal"><span class="pre">current</span></code> will always point at the last
node we created, while our on-clause will move the task ahead to
the next locale.  That way, our execution of <code class="docutils literal"><span class="pre">new</span></code> will create
the new object on that &quot;next&quot; locale.</p>
<div class="highlight-chapel"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">head</span>    <span class="o">=</span> <span class="k">new</span> <span class="nx">Node</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">head</span><span class="p">;</span>

<span class="k">for</span> <span class="nx">i</span> <span class="kd">in</span> <span class="mi">1</span><span class="o">..</span><span class="nx">numLocales</span><span class="o">-</span><span class="mi">1</span> <span class="k">do</span>
  <span class="k">on</span> <span class="nx">Locales</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="p">{</span>
    <span class="nx">current</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Node</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
    <span class="nx">current</span>      <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>Let's loop over the linked list and output each node and the locale on
which it exists using <code class="docutils literal"><span class="pre">.locale.id</span></code> to determine the locale.  This
computation takes place entirely on locale 0 and accesses remote
memory as necessary.</p>
<div class="highlight-chapel"><div class="highlight"><pre><span></span><span class="nx">current</span> <span class="o">=</span> <span class="nx">head</span><span class="p">;</span>

<span class="k">while</span> <span class="nx">current</span> <span class="p">{</span>
  <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;node with data = &quot;</span><span class="p">,</span> <span class="nx">current</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="s">&quot; on locale &quot;</span><span class="p">,</span> <span class="nx">current</span><span class="p">.</span><span class="nx">locale</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
  <span class="nx">current</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">writeln</span><span class="p">();</span>
</pre></div>
</div>
<p>Alternatively, we could use a data-driven execution to walk the
linked list.  Note that on-clauses, when applied to class
variables, resolve to the locale of the object, not the reference.</p>
<div class="highlight-chapel"><div class="highlight"><pre><span></span><span class="nx">current</span> <span class="o">=</span> <span class="nx">head</span><span class="p">;</span>

<span class="k">while</span> <span class="nx">current</span> <span class="p">{</span>
  <span class="k">on</span> <span class="nx">current</span> <span class="p">{</span>
    <span class="nx">writeln</span><span class="p">(</span><span class="s">&quot;node with data = &quot;</span><span class="p">,</span> <span class="nx">current</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="s">&quot; on locale &quot;</span><span class="p">,</span> <span class="nx">here</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
    <span class="nx">current</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can now deallocate our objects to ensure no memory leaks.</p>
<div class="highlight-chapel"><div class="highlight"><pre><span></span><span class="nx">current</span> <span class="o">=</span> <span class="nx">head</span><span class="p">;</span>

<span class="k">while</span> <span class="nx">current</span> <span class="p">{</span>
  <span class="k">on</span> <span class="nx">current</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">ptr</span> <span class="o">=</span> <span class="nx">current</span><span class="p">;</span>
    <span class="nx">current</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">next</span><span class="p">;</span>
    <span class="k">delete</span> <span class="nx">ptr</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For more information about locales, refer to the Locales chapter of
the <a class="reference internal" href="../language/spec.html#chapel-spec"><span>Chapel Language Specification</span></a>.</p>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ranges.html" class="btn btn-neutral float-right" title="Ranges" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="atomics.html" class="btn btn-neutral" title="Atomics" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Cray Inc.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.17.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 



</body>
</html>